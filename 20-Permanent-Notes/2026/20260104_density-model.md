---
id: 202601041658-density-model
created: 2026-01-04
updated: 2026-01-04
tags:
  - permanent
  - engineering
  - optimization
  - numerical-method
  - topology-optimization
type: permanent-note
status: completed
confidence: high
source_type:
  - technical-literature
  - academic
---

# Key Points

- 密度法（Density Method）は、トポロジー最適化で最も広く使用される数値手法
- 各有限要素に材料密度変数（0〜1）を割り当て、0が空洞、1が完全な材料を表す
- SIMP法（Solid Isotropic Material with Penalization）が代表的で、中間密度にペナルティを与えて0/1の二値解を促進

# Context

トポロジー最適化は本来、離散的な問題（材料がある/ない）ですが、これを直接数値的に解くことは困難です。密度法は、この離散問題を連続最適化問題に緩和することで、勾配ベースの最適化アルゴリズムを適用可能にし、実用的な計算時間で解を得ることを可能にした画期的な手法です。

# Body

## 密度法の基本原理

密度法では、設計領域を有限要素メッシュに分割し、各要素に**設計変数としての材料密度** ρ (rho) を割り当てます。

- ρ = 0: 材料なし（空洞）
- ρ = 1: 完全な材料
- 0 < ρ < 1: 中間密度（物理的には意味が曖昧）

材料特性（ヤング率など）は密度の関数として表現されます：

**E(ρ) = E₀ · ρᵖ**

ここで：
- E₀: 基材のヤング率
- p: ペナルティパラメータ（通常3程度）

ペナルティパラメータ p により、中間密度状態が構造的に非効率となり、最適化過程で自然に 0 または 1 に収束します。

## SIMP法（Solid Isotropic Material with Penalization）

最も一般的な密度法の実装方法です。

### 特徴
1. **実装の容易さ**: 既存のFEMコードに容易に組み込める
2. **計算効率**: 勾配ベース最適化（感度解析）が適用可能
3. **汎用性**: 構造、熱、流体など様々な物理現象に適用可能

### 最適化問題の定式化

```
minimize:    目的関数 f(ρ) （例: コンプライアンス）
subject to:  体積制約 V(ρ) ≤ V_max
            0 ≤ ρᵢ ≤ 1  (i = 1, 2, ..., N)
            平衡方程式 K(ρ)u = F
```

ここで：
- K(ρ): 剛性マトリクス（密度に依存）
- u: 変位ベクトル
- F: 荷重ベクトル
- V_max: 許容体積

## 数値的課題と対策

### 1. チェッカーボードパターン
**問題**: メッシュに沿って市松模様の密度分布が現れる数値的アーティファクト

**対策**:
- 密度フィルタ（Density filter）の適用
- 感度フィルタ（Sensitivity filter）の適用
- 高次要素の使用

### 2. メッシュ依存性
**問題**: メッシュの粗さによって最適解が変化

**対策**:
- フィルタリング半径の適切な設定
- メッシュ収束性の検証
- 射影法（Projection method）の使用

### 3. 局所最適解
**問題**: 初期設計により異なる局所解に収束する可能性

**対策**:
- 複数の初期設計からの最適化実行
- 継続法（Continuation method）の使用
- ペナルティパラメータの段階的増加

## フィルタリング技術

### 密度フィルタ
各要素の密度を近傍要素の密度の加重平均で置き換える：

**ρ̃ᵢ = Σⱼ wᵢⱼ ρⱼ / Σⱼ wᵢⱼ**

重み wᵢⱼ は要素間距離に基づいて決定（通常は線形減衰）。

### ヘビサイド射影法
中間密度をさらに抑制し、明瞭な0/1境界を得る手法：

**ρ̄ = (tanh(βη) + tanh(β(ρ̃ - η))) / (tanh(βη) + tanh(β(1 - η)))**

- β: 射影の急峻さを制御
- η: 閾値（通常0.5）

## 実装の流れ

1. **初期化**: 一様密度分布（例: ρ = 体積率）で開始
2. **FEM解析**: 現在の密度分布で構造解析を実行
3. **感度解析**: 目的関数と制約の設計変数に対する勾配を計算
4. **フィルタリング**: 感度または密度にフィルタを適用
5. **最適化**: MMA（Method of Moving Asymptotes）などで設計変数を更新
6. **収束判定**: 変化量が閾値以下なら終了、そうでなければステップ2へ

## Related Concepts

- [[20260104_topology-optimization]] - **上位概念**
    - トポロジー最適化の代表的な実装手法の一つ
- [[20260102_comsol-topology-optimization-gui]] - **GUI実装例**
    - COMSOLにおける密度法の具体的な使用方法（GUI版）
- [[20260104_comsol-topology-optimization-api]] - **API実装例**
    - COMSOLにおける密度法のプログラマティックな実装（API版）
- 有限要素法（FEM） - **計算基盤**
    - 密度法の構造解析・感度解析に不可欠な数値計算手法
- RAMP法（Rational Approximation of Material Properties） - **代替手法**
    - SIMP法と類似の密度ベース手法、異なる材料補間関数を使用
- MMA（Method of Moving Asymptotes） - **最適化アルゴリズム**
    - 密度法で広く使用される勾配ベース最適化手法
- レベルセット法 - **対比手法**
    - 境界を明示的に追跡する別のトポロジー最適化手法
- 感度解析（Sensitivity Analysis） - **必須技術**
    - 設計変数（密度）に対する目的関数の勾配を効率的に計算
- 製造制約（Manufacturing Constraints） - **実用化要素**
    - 最小部材厚、オーバーハング角度などの制約を密度法に組み込む

## Sources
- Bendsøe, M.P., & Sigmund, O. (2003). "Topology Optimization: Theory, Methods and Applications"
- Sigmund, O. (2001). "A 99 line topology optimization code written in MATLAB"
- ALTAIR Topology Optimization Documentation

<!-- 以下はオプション -->

# 応用例と実装の要点

## 典型的な応用

### 1. 構造最適化（最も一般的）
- **目的関数**: コンプライアンス（構造の変形エネルギー）の最小化
- **制約**: 体積制約（材料使用量の上限）
- **例**: 梁、ブラケット、フレーム構造の軽量化

### 2. 熱設計
- **目的関数**: 最大温度の最小化、または熱コンプライアンスの最小化
- **制約**: 体積制約、温度上限制約
- **例**: ヒートシンク、熱交換器の形状最適化

### 3. 流体最適化
- **目的関数**: 圧力損失の最小化、流速の均一化
- **制約**: 体積制約（固体材料の配置）
- **例**: 流路設計、マイクロ流体デバイス

### 4. マルチフィジックス最適化
- **目的関数**: 複数の物理現象を考慮した複合目的関数
- **制約**: 各物理現象に対する制約
- **例**: 熱応力を考慮した構造最適化、熱電素子の最適設計

## 実装時の推奨パラメータ

| パラメータ | 推奨値 | 備考 |
|-----------|--------|------|
| ペナルティ p | 3.0 | 構造最適化の標準値 |
| フィルタ半径 | 要素サイズの1.5〜3倍 | メッシュ依存性を低減 |
| 初期密度 | 体積率 | 均一分布からスタート |
| 移動制限 | 0.2 | 1回の反復での密度変化上限 |
| 収束判定 | 変化率 < 0.01 | 目的関数の変化が1%未満 |

## 利点と制限

### 利点
- 既存のFEMソフトウェアへの実装が容易
- 計算効率が良い（勾配ベース最適化）
- 様々な物理現象に適用可能
- 豊富な文献と実装例が存在

### 制限
- 中間密度の物理的解釈が曖昧
- メッシュ依存性（フィルタで軽減可能）
- 明瞭な境界が得られにくい（射影法で改善可能）
- 局所最適解に陥る可能性

---
- Generated: 2026-01-04
- Status: Completed